{
  "rules": [
    {
      "type": "prd",
      "content": "# AI ì½”ë”© ìµœì í™” PRD v3.0\n> Vercel AI SDKì™€ MCPë¥¼ í™œìš©í•œ ì°¨ì„¸ëŒ€ AI ì½”ë”© ëŒ€ì‹œë³´ë“œ\n\n## ğŸ¯ í”„ë¡œì íŠ¸ ëª©í‘œ\n**ì‚¬ìš©ìì˜ í”„ë¡œì íŠ¸ ì•„ì´ë””ì–´ë¥¼ êµ¬ì¡°í™”ëœ TRDë¡œ ë³€í™˜í•˜ê³ , Taskmaster MCPë¡œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì‘ì—…ìœ¼ë¡œ ë¶„í•´í•˜ëŠ” AI ëŒ€ì‹œë³´ë“œ**\n\n---\n\n## ğŸ”„ í•µì‹¬ ìœ ì € í”Œë¡œìš°\n\n### ë©”ì¸ í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨\n```\n[ë¡œê·¸ì¸ í˜ì´ì§€]\n    â†“ (Google/GitHub OAuth)\n[ëŒ€ì‹œë³´ë“œ - ë¹ˆ ìƒíƒœ]\n    â†“ (ìƒˆ í”„ë¡œì íŠ¸ ë²„íŠ¼ í´ë¦­)\n[Typeform ìŠ¤íƒ€ì¼ ì§ˆë¬¸ ì‹œí€€ìŠ¤]\n    â”œâ”€ Step 1: í”„ë¡œì íŠ¸ ì•„ì´ë””ì–´ (textarea)\n    â”œâ”€ Step 2: í•µì‹¬ ê¸°ëŠ¥ë“¤ (dynamic list)\n    â”œâ”€ Step 3: ìœ ì € í”Œë¡œìš° (guided input)\n    â””â”€ Step 4: ê¸°ìˆ  ì„ í˜¸ë„ (optional chips)\n    â†“ (ìƒì„±í•˜ê¸°)\n[TRD ìƒì„± ì¤‘ - ìŠ¤íŠ¸ë¦¬ë°]\n    â”œâ”€ Brave Searchë¡œ ìµœì‹  ê¸°ìˆ  ê²€ìƒ‰\n    â”œâ”€ Vercel AI SDKë¡œ TRD ì‘ì„±\n    â””â”€ ì‹¤ì‹œê°„ Markdown ë Œë”ë§\n    â†“ (ì™„ë£Œ)\n[TRD ë·° + ì‘ì—… ë¶„ë¦¬ ë²„íŠ¼]\n    â†“ (ì„¸ë¶€ ì‘ì—…ìœ¼ë¡œ ë‚˜ëˆ„ê¸°)\n[Taskmaster MCP ì²˜ë¦¬]\n    â””â”€ ì‘ì—… ì¹´ë“œ ìƒì„±\n    â†“\n[ì™„ì„±ëœ ëŒ€ì‹œë³´ë“œ]\n    â”œâ”€ ì¢Œì¸¡: TRD ë·°ì–´\n    â””â”€ ìš°ì¸¡: ì‘ì—… ì¹´ë“œ ê·¸ë¦¬ë“œ\n```\n\n### ìƒíƒœë³„ UI ìŠ¤í™\n\n#### 1. ë¹ˆ ëŒ€ì‹œë³´ë“œ ìƒíƒœ\n```jsx\n// ì¤‘ì•™ ì •ë ¬ëœ CTA\n<div className=\"flex items-center justify-center h-full\">\n  <Card className=\"max-w-md p-8 text-center\">\n    <Sparkles className=\"w-12 h-12 mx-auto mb-4 text-primary\" />\n    <h2 className=\"text-2xl font-bold mb-2\">ì²« í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”</h2>\n    <p className=\"text-muted-foreground mb-6\">\n      ì•„ì´ë””ì–´ë¥¼ ì…ë ¥í•˜ë©´ AIê°€ TRDì™€ ì‘ì—… ëª©ë¡ì„ ìƒì„±í•©ë‹ˆë‹¤\n    </p>\n    <Button size=\"lg\" className=\"rounded-2xl\">\n      <Plus className=\"mr-2\" /> ìƒˆ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°\n    </Button>\n  </Card>\n</div>\n```\n\n#### 2. Typeform ì§ˆë¬¸ ì‹œí€€ìŠ¤\n```jsx\n// í’€ìŠ¤í¬ë¦° ëª¨ë‹¬ with ì• ë‹ˆë©”ì´ì…˜\n<Dialog open={isOpen} onOpenChange={setIsOpen}>\n  <DialogContent className=\"max-w-2xl h-[80vh]\">\n    {/* Progress Bar */}\n    <div className=\"h-1 bg-secondary rounded-full overflow-hidden\">\n      <div \n        className=\"h-full bg-primary transition-all duration-300\"\n        style={{ width: `${(currentStep / totalSteps) * 100}%` }}\n      />\n    </div>\n    \n    {/* Step Content with Framer Motion */}\n    <AnimatePresence mode=\"wait\">\n      <motion.div\n        key={currentStep}\n        initial={{ opacity: 0, x: 20 }}\n        animate={{ opacity: 1, x: 0 }}\n        exit={{ opacity: 0, x: -20 }}\n      >\n        {renderCurrentStep()}\n      </motion.div>\n    </AnimatePresence>\n  </DialogContent>\n</Dialog>\n```\n\n#### 3. TRD ìŠ¤íŠ¸ë¦¬ë° ë·°\n```jsx\n// ì‹¤ì‹œê°„ Markdown ë Œë”ë§\n<div className=\"relative\">\n  {isStreaming && (\n    <div className=\"absolute top-4 right-4\">\n      <div className=\"flex items-center gap-2 bg-primary/10 px-3 py-1 rounded-full\">\n        <div className=\"w-2 h-2 bg-primary rounded-full animate-pulse\" />\n        <span className=\"text-sm\">AIê°€ ì‘ì„± ì¤‘...</span>\n      </div>\n    </div>\n  )}\n  \n  <ReactMarkdown\n    className=\"prose prose-invert max-w-none\"\n    components={{\n      code: ({ node, inline, className, children, ...props }) => {\n        const match = /language-(\\w+)/.exec(className || '');\n        return !inline && match ? (\n          <SyntaxHighlighter\n            style={vscDarkPlus}\n            language={match[1]}\n            PreTag=\"div\"\n            {...props}\n          >\n            {String(children).replace(/\\n$/, '')}\n          </SyntaxHighlighter>\n        ) : (\n          <code className={className} {...props}>\n            {children}\n          </code>\n        );\n      },\n    }}\n  >\n    {trdContent}\n  </ReactMarkdown>\n</div>\n```\n\n---\n\n## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡° (íŒŒì¼ë‹¹ ì¤„ ìˆ˜ ì œí•œ í¬í•¨)\n\n```\nsrc/\nâ”œâ”€â”€ app/                          # Next.js 15 App Router\nâ”‚   â”œâ”€â”€ layout.tsx               # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ (max 80ì¤„)\nâ”‚   â”œâ”€â”€ page.tsx                 # í™ˆ â†’ /dashboard ë¦¬ë‹¤ì´ë ‰íŠ¸ (max 15ì¤„)\nâ”‚   â”œâ”€â”€ auth/\nâ”‚   â”‚   â””â”€â”€ page.tsx            # Supabase Auth UI (max 100ì¤„)\nâ”‚   â”œâ”€â”€ dashboard/\nâ”‚   â”‚   â”œâ”€â”€ layout.tsx          # ëŒ€ì‹œë³´ë“œ ë ˆì´ì•„ì›ƒ (max 120ì¤„)\nâ”‚   â”‚   â””â”€â”€ page.tsx            # ë©”ì¸ ëŒ€ì‹œë³´ë“œ (max 150ì¤„)\nâ”‚   â””â”€â”€ api/\nâ”‚       â”œâ”€â”€ ai/\nâ”‚       â”‚   â””â”€â”€ route.ts        # Vercel AI SDK ì—”ë“œí¬ì¸íŠ¸ (max 100ì¤„)\nâ”‚       â””â”€â”€ search/\nâ”‚           â””â”€â”€ route.ts        # Brave Search API (max 80ì¤„)\nâ”‚\nâ”œâ”€â”€ components/\nâ”‚   â”œâ”€â”€ layout/\nâ”‚   â”‚   â”œâ”€â”€ sidebar/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx       # ì‚¬ì´ë“œë°” ì»¨í…Œì´ë„ˆ (max 100ì¤„)\nâ”‚   â”‚   â”‚   â”œâ”€â”€ project-list.tsx # í”„ë¡œì íŠ¸ ëª©ë¡ (max 80ì¤„)\nâ”‚   â”‚   â”‚   â””â”€â”€ user-menu.tsx   # ìœ ì € ë©”ë‰´ (max 60ì¤„)\nâ”‚   â”‚   â””â”€â”€ header/\nâ”‚   â”‚       â”œâ”€â”€ index.tsx       # í—¤ë” ì»¨í…Œì´ë„ˆ (max 80ì¤„)\nâ”‚   â”‚       â””â”€â”€ theme-toggle.tsx # ë‹¤í¬ëª¨ë“œ í† ê¸€ (max 40ì¤„)\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ project-form/           # Typeform ìŠ¤íƒ€ì¼ í¼\nâ”‚   â”‚   â”œâ”€â”€ index.tsx          # í¼ ì»¨í…Œì´ë„ˆ (max 120ì¤„)\nâ”‚   â”‚   â”œâ”€â”€ steps/\nâ”‚   â”‚   â”‚   â”œâ”€â”€ idea-step.tsx  # Step 1 (max 80ì¤„)\nâ”‚   â”‚   â”‚   â”œâ”€â”€ features-step.tsx # Step 2 (max 100ì¤„)\nâ”‚   â”‚   â”‚   â”œâ”€â”€ flow-step.tsx  # Step 3 (max 100ì¤„)\nâ”‚   â”‚   â”‚   â””â”€â”€ tech-step.tsx  # Step 4 (max 80ì¤„)\nâ”‚   â”‚   â””â”€â”€ progress-bar.tsx   # ì§„í–‰ë¥  í‘œì‹œ (max 40ì¤„)\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ trd-viewer/\nâ”‚   â”‚   â”œâ”€â”€ index.tsx          # TRD ë·°ì–´ ë©”ì¸ (max 150ì¤„)\nâ”‚   â”‚   â”œâ”€â”€ markdown-renderer.tsx # Markdown ë Œë”ëŸ¬ (max 100ì¤„)\nâ”‚   â”‚   â””â”€â”€ copy-button.tsx    # ë³µì‚¬ ë²„íŠ¼ (max 60ì¤„)\nâ”‚   â”‚\nâ”‚   â”œâ”€â”€ task-cards/\nâ”‚   â”‚   â”œâ”€â”€ index.tsx          # ì‘ì—… ì¹´ë“œ ê·¸ë¦¬ë“œ (max 120ì¤„)\nâ”‚   â”‚   â”œâ”€â”€ task-card.tsx      # ê°œë³„ ì¹´ë“œ (max 100ì¤„)\nâ”‚   â”‚   â””â”€â”€ export-button.tsx  # ì „ì²´ ë‚´ë³´ë‚´ê¸° (max 80ì¤„)\nâ”‚   â”‚\nâ”‚   â””â”€â”€ ui/                    # shadcn/ui ì»´í¬ë„ŒíŠ¸\nâ”‚\nâ”œâ”€â”€ hooks/\nâ”‚   â”œâ”€â”€ use-project.ts         # í”„ë¡œì íŠ¸ ìƒíƒœ ê´€ë¦¬ (max 100ì¤„)\nâ”‚   â”œâ”€â”€ use-ai-stream.ts       # AI ìŠ¤íŠ¸ë¦¬ë° (max 80ì¤„)\nâ”‚   â””â”€â”€ use-mcp.ts            # MCP í†µí•© (max 80ì¤„)\nâ”‚\nâ”œâ”€â”€ lib/\nâ”‚   â”œâ”€â”€ supabase/\nâ”‚   â”‚   â”œâ”€â”€ client.ts         # í´ë¼ì´ì–¸íŠ¸ ì„¤ì • (max 30ì¤„)\nâ”‚   â”‚   â””â”€â”€ middleware.ts     # ë¯¸ë“¤ì›¨ì–´ (max 50ì¤„)\nâ”‚   â”œâ”€â”€ ai/\nâ”‚   â”‚   â”œâ”€â”€ prompts.ts        # í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ (max 150ì¤„)\nâ”‚   â”‚   â””â”€â”€ vercel-ai.ts      # Vercel AI ì„¤ì • (max 50ì¤„)\nâ”‚   â””â”€â”€ mcp/\nâ”‚       â””â”€â”€ taskmaster.ts     # Taskmaster MCP (max 100ì¤„)\nâ”‚\nâ””â”€â”€ types/\n    â”œâ”€â”€ project.ts            # í”„ë¡œì íŠ¸ íƒ€ì… (max 50ì¤„)\n    â”œâ”€â”€ trd.ts               # TRD íƒ€ì… (max 40ì¤„)\n    â””â”€â”€ task.ts              # ì‘ì—… íƒ€ì… (max 40ì¤„)\n```\n\n---\n\n## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ ìƒì„¸\n\n### í•µì‹¬ ì˜ì¡´ì„±\n```json\n{\n  \"dependencies\": {\n    // Framework\n    \"next\": \"15.0.2\",\n    \"react\": \"19.0.0\",\n    \"react-dom\": \"19.0.0\",\n    \n    // AI & Streaming\n    \"ai\": \"^3.4.0\",              // Vercel AI SDK\n    \"openai\": \"^4.72.0\",         // OpenAI í´ë¼ì´ì–¸íŠ¸\n    \n    // Database & Auth\n    \"@supabase/supabase-js\": \"^2.46.0\",\n    \"@supabase/ssr\": \"^0.5.1\",\n    \n    // UI Components\n    \"@radix-ui/react-dialog\": \"^1.1.2\",\n    \"@radix-ui/react-dropdown-menu\": \"^2.1.2\",\n    \"@radix-ui/react-tabs\": \"^1.1.1\",\n    \"lucide-react\": \"^0.454.0\",\n    \"framer-motion\": \"^11.11.0\",\n    \n    // Forms & Validation\n    \"react-hook-form\": \"^7.54.0\",\n    \"@hookform/resolvers\": \"^3.9.0\",\n    \"zod\": \"^3.23.8\",\n    \n    // Markdown\n    \"react-markdown\": \"^9.0.1\",\n    \"remark-gfm\": \"^4.0.0\",\n    \"rehype-highlight\": \"^7.0.0\",\n    \n    // Utilities\n    \"clsx\": \"^2.1.1\",\n    \"tailwind-merge\": \"^2.5.0\",\n    \"date-fns\": \"^4.1.0\"\n  }\n}\n```\n\n### í™˜ê²½ ë³€ìˆ˜ êµ¬ì¡°\n```env\n# Supabase\nNEXT_PUBLIC_SUPABASE_URL=https://[PROJECT_ID].supabase.co\nNEXT_PUBLIC_SUPABASE_ANON_KEY=eyJ...\n\n# AI Services  \nOPENAI_API_KEY=sk-...\nBRAVE_SEARCH_API_KEY=BSA...\n\n# Vercel AI SDK\nAI_PROVIDER=openai\nAI_MODEL=gpt-4o\n```\n\n---\n\n## ğŸ’¡ í•µì‹¬ êµ¬í˜„ íŒ¨í„´\n\n### 1. Vercel AI SDK ìŠ¤íŠ¸ë¦¬ë° êµ¬í˜„\n```typescript\n// app/api/ai/route.ts\nimport { openai } from '@ai-sdk/openai';\nimport { streamText } from 'ai';\n\nexport async function POST(req: Request) {\n  const { prompt, context } = await req.json();\n  \n  // Brave Search ê²°ê³¼ë¥¼ contextì— í¬í•¨\n  const searchResults = await searchLatestTech(context.techStack);\n  \n  const result = streamText({\n    model: openai('gpt-4o'),\n    messages: [\n      {\n        role: 'system',\n        content: 'You are an expert technical architect...'\n      },\n      {\n        role: 'user',\n        content: `${prompt}\\n\\nLatest tech info:\\n${searchResults}`\n      }\n    ],\n    temperature: 0.7,\n  });\n  \n  return result.toDataStreamResponse();\n}\n```\n\n### 2. MCP Taskmaster í†µí•©\n```typescript\n// lib/mcp/taskmaster.ts\nimport { MCPClient } from '@modelcontextprotocol/sdk';\n\nexport async function breakdownToTasks(trd: string) {\n  const mcp = new MCPClient({\n    serverName: 'taskmaster',\n    transport: 'stdio'\n  });\n  \n  await mcp.connect();\n  \n  const result = await mcp.callTool('request_planning', {\n    originalRequest: trd,\n    tasks: await generateInitialTasks(trd)\n  });\n  \n  return result.tasks;\n}\n```\n\n### 3. ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° í›…\n```typescript\n// hooks/use-ai-stream.ts\nimport { useCompletion } from 'ai/react';\n\nexport function useAIStream() {\n  const { completion, isLoading, complete } = useCompletion({\n    api: '/api/ai',\n    onFinish: (prompt, completion) => {\n      // TRD ìƒì„± ì™„ë£Œ í›„ ìë™ ì €ì¥\n      saveToSupabase(completion);\n    }\n  });\n  \n  return { \n    content: completion,\n    isStreaming: isLoading,\n    generate: complete\n  };\n}\n```\n\n---\n\n## ğŸ¨ UI ì»´í¬ë„ŒíŠ¸ ìƒì„¸ ìŠ¤í™\n\n### 1. ì‚¬ì´ë“œë°” ë„¤ë¹„ê²Œì´ì…˜\n```jsx\n// ë°˜ì‘í˜• ë“œë¡œì–´ + ë°ìŠ¤í¬í†± ê³ ì •\n<aside className={cn(\n  \"fixed inset-y-0 z-50 flex h-full w-72 flex-col\",\n  \"bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\",\n  \"border-r transition-transform duration-300\",\n  // ëª¨ë°”ì¼: ë“œë¡œì–´ ë°©ì‹\n  \"lg:relative lg:translate-x-0\",\n  isOpen ? \"translate-x-0\" : \"-translate-x-full\"\n)}>\n  <SidebarHeader />\n  <ProjectList projects={projects} />\n  <SidebarFooter>\n    <UserMenu />\n  </SidebarFooter>\n</aside>\n```\n\n### 2. ì‘ì—… ì¹´ë“œ ë“œë˜ê·¸ ì•¤ ë“œë¡­\n```jsx\n// Framer Motionìœ¼ë¡œ ìˆœì„œ ë³€ê²½\n<Reorder.Group values={tasks} onReorder={setTasks}>\n  {tasks.map((task) => (\n    <Reorder.Item\n      key={task.id}\n      value={task}\n      className=\"group\"\n      whileHover={{ scale: 1.02 }}\n      whileTap={{ scale: 0.98 }}\n    >\n      <TaskCard task={task} />\n    </Reorder.Item>\n  ))}\n</Reorder.Group>\n```\n\n### 3. ë³µì‚¬ ë²„íŠ¼ í”¼ë“œë°±\n```jsx\n// ë³µì‚¬ ì„±ê³µ ì‹œ ì• ë‹ˆë©”ì´ì…˜\n<Button\n  onClick={handleCopy}\n  variant=\"ghost\"\n  size=\"sm\"\n  className=\"gap-2\"\n>\n  <AnimatePresence mode=\"wait\">\n    {isCopied ? (\n      <motion.div\n        initial={{ scale: 0 }}\n        animate={{ scale: 1 }}\n        exit={{ scale: 0 }}\n      >\n        <Check className=\"h-4 w-4 text-green-500\" />\n      </motion.div>\n    ) : (\n      <Copy className=\"h-4 w-4\" />\n    )}\n  </AnimatePresence>\n  {isCopied ? \"ë³µì‚¬ë¨!\" : \"ë³µì‚¬\"}\n</Button>\n```\n\n---\n\n## ğŸ” Supabase ìŠ¤í‚¤ë§ˆ\n\n### í…Œì´ë¸” êµ¬ì¡°\n```sql\n-- í”„ë¡œì íŠ¸ í…Œì´ë¸”\nCREATE TABLE projects (\n  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,\n  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,\n  name TEXT NOT NULL,\n  idea TEXT NOT NULL,\n  features JSONB,\n  user_flow TEXT,\n  tech_preferences TEXT[],\n  trd_content TEXT,\n  status TEXT DEFAULT 'draft',\n  created_at TIMESTAMPTZ DEFAULT NOW(),\n  updated_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- ì‘ì—… í…Œì´ë¸”  \nCREATE TABLE tasks (\n  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,\n  project_id UUID REFERENCES projects(id) ON DELETE CASCADE,\n  title TEXT NOT NULL,\n  description TEXT,\n  priority TEXT CHECK (priority IN ('high', 'medium', 'low')),\n  estimated_time TEXT,\n  dependencies UUID[],\n  order_index INTEGER,\n  created_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- RLS ì •ì±…\nALTER TABLE projects ENABLE ROW LEVEL SECURITY;\nALTER TABLE tasks ENABLE ROW LEVEL SECURITY;\n\nCREATE POLICY \"Users can view own projects\" ON projects\n  FOR SELECT USING (auth.uid() = user_id);\n  \nCREATE POLICY \"Users can create own projects\" ON projects\n  FOR INSERT WITH CHECK (auth.uid() = user_id);\n```\n\n---\n\n## ğŸ“‹ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§\n\n### TRD ìƒì„± í”„ë¡¬í”„íŠ¸\n```typescript\nconst TRD_SYSTEM_PROMPT = `\nYou are an expert technical architect specializing in modern web development.\nYour task is to create a comprehensive Technical Requirements Document (TRD).\n\nGuidelines:\n1. Use the latest stable versions of technologies\n2. Prioritize developer experience and maintainability\n3. Include specific implementation details\n4. Structure the document with clear sections\n5. Provide code examples where relevant\n\nOutput Format:\n- Use Markdown with proper headings\n- Include code blocks with syntax highlighting\n- Add tables for API endpoints and data models\n- Keep sections concise but complete\n`;\n\nconst generateTRDPrompt = (data: ProjectFormData) => `\nProject Idea: ${data.idea}\n\nCore Features:\n${data.features.map((f, i) => `${i + 1}. ${f}`).join('\\n')}\n\nUser Flow:\n${data.userFlow}\n\nTech Preferences: ${data.techPreferences?.join(', ') || 'No specific preferences'}\n\nBased on the above information and the latest tech trends from Brave Search,\ncreate a comprehensive TRD that includes:\n\n1. Executive Summary\n2. Technical Architecture\n3. Component Structure  \n4. API Design\n5. Database Schema\n6. Security Considerations\n7. Performance Optimization\n8. Deployment Strategy\n`;\n```\n\n### ì‘ì—… ë¶„í•´ í”„ë¡¬í”„íŠ¸\n```typescript\nconst TASK_BREAKDOWN_PROMPT = `\nBreak down the following TRD into actionable development tasks.\n\nEach task should:\n- Be completable in 2-4 hours\n- Have clear acceptance criteria\n- Include any dependencies on other tasks\n- Be assigned a priority (high/medium/low)\n- Include estimated time\n\nFormat each task as:\n{\n  \"title\": \"Task title\",\n  \"description\": \"Detailed description\",\n  \"priority\": \"high|medium|low\",\n  \"estimatedTime\": \"2-4 hours\",\n  \"dependencies\": [\"task-id-1\", \"task-id-2\"],\n  \"acceptanceCriteria\": [\n    \"Criterion 1\",\n    \"Criterion 2\"\n  ]\n}\n`;\n```\n\n---\n\n## ğŸš€ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸\n\n### Phase 1: ê¸°ì´ˆ ì„¤ì • (3ì‹œê°„)\n- [ ] Next.js 15 í”„ë¡œì íŠ¸ ìƒì„±\n- [ ] Supabase í”„ë¡œì íŠ¸ ì„¤ì • ë° ìŠ¤í‚¤ë§ˆ ìƒì„±\n- [ ] shadcn/ui ì„¤ì¹˜ (`npx shadcn@latest init`)\n- [ ] ë‹¤í¬ëª¨ë“œ í…Œë§ˆ ì„¤ì •\n- [ ] í™˜ê²½ ë³€ìˆ˜ êµ¬ì„±\n\n### Phase 2: ì¸ì¦ & ë ˆì´ì•„ì›ƒ (4ì‹œê°„)\n- [ ] Supabase Auth í†µí•©\n- [ ] ì‚¬ì´ë“œë°” êµ¬í˜„ (ëª¨ë°”ì¼ ë°˜ì‘í˜•)\n- [ ] í—¤ë” & í…Œë§ˆ í† ê¸€\n- [ ] í”„ë¡œì íŠ¸ ëª©ë¡ ì»´í¬ë„ŒíŠ¸\n\n### Phase 3: í•µì‹¬ ê¸°ëŠ¥ êµ¬í˜„ (6ì‹œê°„)\n- [ ] Typeform ìŠ¤íƒ€ì¼ í”„ë¡œì íŠ¸ ìƒì„± í¼\n- [ ] Vercel AI SDK í†µí•©\n- [ ] TRD ìŠ¤íŠ¸ë¦¬ë° ë·°ì–´\n- [ ] Markdown ë Œë”ëŸ¬ & ì½”ë“œ í•˜ì´ë¼ì´íŒ…\n- [ ] ë³µì‚¬ ê¸°ëŠ¥ êµ¬í˜„\n\n### Phase 4: MCP & ì‘ì—… ê´€ë¦¬ (5ì‹œê°„)\n- [ ] Taskmaster MCP ì—°ë™\n- [ ] ì‘ì—… ì¹´ë“œ UI\n- [ ] ë“œë˜ê·¸ ì•¤ ë“œë¡­\n- [ ] ì „ì²´ ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥\n- [ ] Brave Search API í†µí•©\n\n### Phase 5: ë§ˆë¬´ë¦¬ (2ì‹œê°„)\n- [ ] ì—ëŸ¬ ì²˜ë¦¬ & ë¡œë”© ìƒíƒœ\n- [ ] ì„±ëŠ¥ ìµœì í™”\n- [ ] ë°°í¬ ì¤€ë¹„\n- [ ] í…ŒìŠ¤íŠ¸ & ë””ë²„ê¹…\n\n---\n\n## ğŸ” í•µì‹¬ ì°¨ë³„í™” ìš”ì†Œ\n\n1. **ì‹¤ì‹œê°„ AI ìŠ¤íŠ¸ë¦¬ë°**: Vercel AI SDKë¡œ TRDê°€ ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ê²ƒì„ ì‹œê°ì ìœ¼ë¡œ í™•ì¸\n2. **Taskmaster MCP í†µí•©**: ë‹¨ìˆœ í…ìŠ¤íŠ¸ê°€ ì•„ë‹Œ êµ¬ì¡°í™”ëœ ì‘ì—… ë‹¨ìœ„ë¡œ ìë™ ë¶„í•´\n3. **ìµœì‹  ê¸°ìˆ  ë°˜ì˜**: Brave Searchë¡œ ì‹¤ì‹œê°„ ê¸°ìˆ  íŠ¸ë Œë“œ ê²€ìƒ‰ í›„ TRDì— ë°˜ì˜\n4. **Typeform UX**: ë‹¨ê³„ë³„ ê°€ì´ë“œë¡œ ì‚¬ìš©ì ë¶€ë‹´ ìµœì†Œí™”\n5. **ì›í´ë¦­ ë³µì‚¬**: TRDì™€ ì‘ì—… ëª©ë¡ì„ ì¦‰ì‹œ ë‹¤ë¥¸ AI ë„êµ¬ì—ì„œ í™œìš© ê°€ëŠ¥\n\nì´ PRDëŠ” AIê°€ ì½”ë“œë¥¼ ìƒì„±í•  ë•Œ í•„ìš”í•œ ëª¨ë“  êµ¬í˜„ ë””í…Œì¼ì„ í¬í•¨í•˜ë©´ì„œë„, \në¶ˆí•„ìš”í•œ ë§ˆì´í¬ë¡œë§¤ë‹ˆì§•ì„ í”¼í•˜ê³  ê°œë°œìì˜ ì°½ì˜ì„±ì„ ì¡´ì¤‘í•˜ëŠ” ê· í˜•ì„ ë§ì·„ìŠµë‹ˆë‹¤.\n",
      "writedAt": "2025-07-20T07:19:19.082Z"
    },
    {
      "type": "architecture",
      "content": "# Technical Requirements Document (TRD)\n\n## 1. Executive Technical Summary\n\n### í”„ë¡œì íŠ¸ ê°œìš”\nAI ê¸°ë°˜ í”„ë¡œì íŠ¸ ì•„ì´ë””ì–´ ì…ë ¥ì„ í†µí•´ êµ¬ì¡°í™”ëœ Technical Requirements Document(TRD)ë¥¼ ìƒì„±í•˜ê³ , ì´ë¥¼ Taskmaster MCPë¡œ ìë™ ë¶„í•´í•˜ì—¬ ì‹¤í–‰ ê°€ëŠ¥í•œ ì‘ì—… ì¹´ë“œë¡œ ì œê³µí•˜ëŠ” ì›¹ ëŒ€ì‹œë³´ë“œì…ë‹ˆë‹¤. Next.js 15 App Routerë¥¼ ì‚¬ìš©í•œ ëª¨ë˜ React í”„ë ˆì„ì›Œí¬ ìœ„ì—ì„œ Vercel AI SDKÂ·Brave SearchÂ·SupabaseÂ·MCPë¥¼ ìœ ê¸°ì ìœ¼ë¡œ ì—°ë™í•©ë‹ˆë‹¤.\n\n### í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ\n- í”„ë ˆì„ì›Œí¬: Next.js 15 (App Router) + React 19 + TypeScript  \n- UI: Tailwind CSS + shadcn/ui(Radix UI) + Framer Motion  \n- AI: Vercel AI SDK(`ai` íŒ¨í‚¤ì§€) + OpenAI í´ë¼ì´ì–¸íŠ¸  \n- ê²€ìƒ‰: Brave Search API  \n- ë°ì´í„°ë² ì´ìŠ¤Â·ì¸ì¦: Supabase (PostgreSQL, RLS)  \n- ì‘ì—… ë¶„í•´: Taskmaster MCP (`@modelcontextprotocol/sdk`)  \n- í¼Â·ìœ íš¨ì„±: React Hook Form + Zod  \n- ë§ˆí¬ë‹¤ìš´: react-markdown + remark-gfm + rehype-highlight\n\n### ì£¼ìš” ê¸°ìˆ  ëª©í‘œ\n- ì‘ë‹µ ì§€ì—°ì‹œê°„: API í‰ê·  â‰¤200ms  \n- ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°: TRD ìƒì„± ì¤‘ ì‹¤ì‹œê°„ Markdown ë Œë”ë§  \n- ê°€ìš©ì„±: 99.9% ì´ìƒ  \n- í™•ì¥ì„±: ìˆ˜ë°± ê°œ ë™ì‹œ ëŒ€ì‹œë³´ë“œ ì„¸ì…˜ ëŒ€ì‘\n\n### ì£¼ìš” ê°€ì •\n- ì´ˆê¸° ì‚¬ìš©ì ìˆ˜ëŠ” ìˆ˜ë°± ëª… ìˆ˜ì¤€  \n- OpenAIÂ·Brave SearchÂ·MCP ì„œë¹„ìŠ¤ SLA ì¤€ìˆ˜  \n- Supabase ë¬´ë£Œ í”Œëœ ë˜ëŠ” ì €ë¹„ìš©ìœ¼ë¡œ ì‹œì‘ ê°€ëŠ¥  \n- TypeScript ê¸°ë°˜ ì½”ë“œë² ì´ìŠ¤ë¡œ íŒ€ ìƒì‚°ì„± ìœ ì§€\n\n---\n\n## 2. Tech Stack\n\n| Category             | Technology / Library                       | Reasoning (ì„ íƒ ì´ìœ )                                    |\n| -------------------- | ------------------------------------------ | -------------------------------------------------------- |\n| Language             | TypeScript                                 | ì •ì  íƒ€ì… ê²€ì‚¬ë¡œ ì•ˆì •ì„±Â·ê°€ë…ì„± í™•ë³´                       |\n| Framework            | Next.js 15 (App Router) + React 19         | ëª¨ë˜ SSR/SSG ì§€ì›, íŒŒì¼ ê¸°ë°˜ ë¼ìš°íŒ…, React ë™ì  ê¸°ëŠ¥       |\n| UI Toolkit           | Tailwind CSS + shadcn/ui (Radix UI)        | ë¹ ë¥¸ ìŠ¤íƒ€ì¼ë§, ì ‘ê·¼ì„± ë†’ì€ ì»´í¬ë„ŒíŠ¸ ì œê³µ                 |\n| Motion & Animation   | Framer Motion                              | UX ê°œì„ ìš© ê°„í¸ ì• ë‹ˆë©”ì´ì…˜                                 |\n| AI SDK               | `ai` (Vercel AI SDK)                       | ìŠ¤íŠ¸ë¦¬ë° ì§€ì›, Vercel ìµœì í™”                              |\n| OpenAI Client        | `openai`                                   | GPT-4 ëª¨ë¸ í™œìš©                                          |\n| Search API           | Brave Search API                           | ìµœì‹  ê¸°ìˆ  íŠ¸ë Œë“œ ì‹¤ì‹œê°„ ê²€ìƒ‰                              |\n| Database & Auth      | Supabase (`@supabase/supabase-js`, RLS)     | ë¹ ë¥¸ ê°œë°œ, ë‚´ì¥ ì¸ì¦Â·ë°ì´í„°ë² ì´ìŠ¤                         |\n| Task Orchestration   | `@modelcontextprotocol/sdk` (MCP)          | Taskmaster ê¸°ë°˜ ì‘ì—… ë¶„í•´                                 |\n| Forms & Validation   | React Hook Form + Zod                      | ì„ ì–¸ì  í¼ ê´€ë¦¬Â·ìŠ¤í‚¤ë§ˆ ê¸°ë°˜ ìœ íš¨ì„± ê²€ì‚¬                    |\n| Markdown Rendering   | react-markdown + remark-gfm + rehype-highlight | ì‹¤ì‹œê°„ Markdown íŒŒì‹±Â·í•˜ì´ë¼ì´íŒ…                           |\n| Utilities            | clsx, tailwind-merge, date-fns             | í´ë˜ìŠ¤ëª… ê²°í•©Â·ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜                                |\n\n---\n\n## 3. System Architecture Design\n\n### Top-Level Building Blocks\n- Frontend (Next.js App Router)  \n  - ì¸ì¦(Auth): Supabase Auth UI  \n  - ëŒ€ì‹œë³´ë“œ: TRD ë·°ì–´ & ì‘ì—… ì¹´ë“œ ê·¸ë¦¬ë“œ  \n  - í¼: Typeform ìŠ¤íƒ€ì¼ ì§ˆë¬¸ ì‹œí€€ìŠ¤  \n- Backend API (Next.js API Routes)  \n  - `/api/ai`: Vercel AI SDK ìŠ¤íŠ¸ë¦¬ë° ì—”ë“œí¬ì¸íŠ¸  \n  - `/api/search`: Brave Search ì—°ë™  \n- Database (Supabase PostgreSQL)  \n  - í”„ë¡œì íŠ¸Â·ì‘ì—… í…Œì´ë¸”, RLS ì •ì±…  \n- Taskmaster MCP ì„œë¹„ìŠ¤  \n  - TRD â†’ ì‘ì—… ë‹¨ìœ„ ë¶„í•´ ì²˜ë¦¬  \n- ì™¸ë¶€ ì„œë¹„ìŠ¤  \n  - OpenAI, Brave Search, MCP\n\n### Top-Level Component Interaction Diagram\n```mermaid\ngraph TD\n    A[Frontend(UI)] --> B[API Layer]\n    B --> C[Supabase DB]\n    B --> D[Vercel AI SDK]\n    B --> E[Brave Search]\n    B --> F[Taskmaster MCP]\n    C --> B\n    D --> B\n    F --> B\n```\n- FrontendëŠ” API Layerë¥¼ í†µí•´ AI ìƒì„±Â·ê²€ìƒ‰Â·DBÂ·MCPì™€ í†µì‹   \n- API LayerëŠ” ê°ê° Vercel AI SDK, Brave Search, Taskmaster MCP í˜¸ì¶œ  \n- Supabase DBëŠ” í”„ë¡œì íŠ¸Â·ì‘ì—… ë°ì´í„°ë¥¼ ì €ì¥Â·ì¡°íšŒ  \n\n### Code Organization & Convention\n\n**Domain-Driven ì¡°ì§ ì „ëµ**\n- Domain Separation: `project`, `trd`, `task` ë„ë©”ì¸ êµ¬ë¶„  \n- Layer-Based Architecture: `app` (presentation), `lib` (infrastructure), `hooks` (logic), `components` (UI), `types`  \n- Feature-Based Modules: ê° ì£¼ìš” ê¸°ëŠ¥ë³„ í´ë”(`project-form`, `trd-viewer`, `task-cards`)  \n- Shared Components: `ui` ëª¨ë“ˆì— ê³µí†µ ì»´í¬ë„ŒíŠ¸Â·ìœ í‹¸ë¦¬í‹°  \n\n**íŒŒì¼Â·í´ë” êµ¬ì¡°**\n```\nsrc/\nâ”œâ”€â”€ app/\nâ”‚   â”œâ”€â”€ layout.tsx\nâ”‚   â”œâ”€â”€ page.tsx\nâ”‚   â”œâ”€â”€ auth/\nâ”‚   â”‚   â””â”€â”€ page.tsx\nâ”‚   â”œâ”€â”€ dashboard/\nâ”‚   â”‚   â”œâ”€â”€ layout.tsx\nâ”‚   â”‚   â””â”€â”€ page.tsx\nâ”‚   â””â”€â”€ api/\nâ”‚       â”œâ”€â”€ ai/\nâ”‚       â”‚   â””â”€â”€ route.ts\nâ”‚       â””â”€â”€ search/\nâ”‚           â””â”€â”€ route.ts\nâ”œâ”€â”€ components/\nâ”‚   â”œâ”€â”€ layout/\nâ”‚   â”œâ”€â”€ project-form/\nâ”‚   â”œâ”€â”€ trd-viewer/\nâ”‚   â”œâ”€â”€ task-cards/\nâ”‚   â””â”€â”€ ui/\nâ”œâ”€â”€ hooks/\nâ”‚   â”œâ”€â”€ use-project.ts\nâ”‚   â”œâ”€â”€ use-ai-stream.ts\nâ”‚   â””â”€â”€ use-mcp.ts\nâ”œâ”€â”€ lib/\nâ”‚   â”œâ”€â”€ supabase/\nâ”‚   â”œâ”€â”€ ai/\nâ”‚   â””â”€â”€ mcp/\nâ””â”€â”€ types/\n    â”œâ”€â”€ project.ts\n    â”œâ”€â”€ trd.ts\n    â””â”€â”€ task.ts\n```\n\n### Data Flow & Communication Patterns\n- Client-Server Communication: Next.js API Route JSON request/response, ìŠ¤íŠ¸ë¦¬ë° `ReadableStream`  \n- Database Interaction: Supabase JS í´ë¼ì´ì–¸íŠ¸, RLS í™œì„±í™”, ë‹¨ì¼ ì—°ê²° í’€ ê´€ë¦¬  \n- External Service Integration: Brave SearchÂ·OpenAIÂ·MCP í´ë¼ì´ì–¸íŠ¸ ëª¨ë“ˆ ì¶”ìƒí™”  \n- Real-time Communication: Vercel AI SDK ìŠ¤íŠ¸ë¦¬ë° ì‚¬ìš©, React Markdown ì‹¤ì‹œê°„ ë Œë”ë§  \n- Data Synchronization: UI ìƒíƒœ í›…(`use-project`)ì„ í†µí•œ ì¤‘ì•™ ê´€ë¦¬, optimistic update ê³ ë ¤\n\n---\n\n## 4. Performance & Optimization Strategy\n- AI ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ì´ˆê¸° ë°”ì´íŠ¸ ìˆ˜ì‹  ìµœì í™”(keep-alive)  \n- Next.js ISR/SSG ë¶ˆí•„ìš” í˜ì´ì§€ ì œì™¸, ìˆœìˆ˜ CSR êµ¬ì„±  \n- DB ì¸ë±ì‹±: `projects.user_id`, `tasks.project_id`  \n- í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìºì‹±: SWR í˜¹ì€ React Query ì‚¬ìš© ê³ ë ¤  \n\n---\n\n## 5. Implementation Roadmap & Milestones\n\n### Phase 1: Foundation (MVP êµ¬í˜„)  \n- Core Infrastructure: Next.js 15 í”„ë¡œì íŠ¸ ì„¤ì •, Supabase ìŠ¤í‚¤ë§ˆ ìƒì„±  \n- Essential Features: ì¸ì¦Â·ë¹ˆ ëŒ€ì‹œë³´ë“œÂ·Typeform í¼Â·TRD ìŠ¤íŠ¸ë¦¬ë° ë·°ì–´  \n- Basic Security: RLS ì •ì±…, í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬  \n- Development Setup: GitHub Actions CI, Prettier/ESLint  \n- Timeline: 1ì£¼\n\n### Phase 2: Feature Enhancement  \n- Advanced Features: ì‘ì—… ë¶„í•´ ë²„íŠ¼Â·Taskmaster MCP ì—°ë™  \n- Performance Optimization: AI ìŠ¤íŠ¸ë¦¬ë° íŠœë‹, DB ì¸ë±ì‹±  \n- Enhanced Security: í† í° ë¹„ë°€ ê´€ë¦¬ ê°•í™”, XSS/CSRF ë°©ì–´  \n- Monitoring Implementation: Vercel Analytics, Sentry  \n- Timeline: 2ì£¼\n\n### Phase 3: Scaling & Optimization  \n- Scalability Implementation: Auto-scaling(ì„œë²„ë¦¬ìŠ¤), ìºì‹œ ë ˆì´ì–´ ë„ì…  \n- Advanced Integrations: ì†Œì…œ ë¡œê·¸ì¸ ì¶”ê°€, Webhook ì§€ì›  \n- Enterprise Features: ë‹¤ì¤‘ ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬, ì¡°ì§ ë‹¨ìœ„ í”„ë¡œì íŠ¸  \n- Compliance & Auditing: GDPR, SOC2 ê¸°ë³¸ ì¤€ìˆ˜  \n- Timeline: 3ì£¼\n\n---\n\n## 6. Risk Assessment & Mitigation Strategies\n\n### Technical Risk Analysis\n- Technology Risks: AI ì„œë¹„ìŠ¤ API ë³€ê²½ â†’ ë²„ì „ ê³ ì •Â·í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ê°•í™”  \n- Performance Risks: ìŠ¤íŠ¸ë¦¬ë° ì§€ì—° â†’ CDN, keep-alive ì„¤ì •  \n- Security Risks: RLS ëˆ„ë½Â·ì¸ì¦ ìš°íšŒ â†’ ìë™í™”ëœ ì •ì±… ê²€ì¦, íœí…ŒìŠ¤íŠ¸  \n- Integration Risks: Brave SearchÂ·MCP ì¥ì•  â†’ ì¬ì‹œë„ ë¡œì§, í´ë°± ëª¨ë“œ  \n\n**Mitigation Strategies**  \n- ê²€ì¦ëœ SDK ì‚¬ìš©, ì‹œë®¬ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸  \n- Circuit Breaker íŒ¨í„´ ë„ì… ë° ë°±ì˜¤í”„ ì¬ì‹œë„  \n- ë¯¼ê° ë°ì´í„° ì•”í˜¸í™” ë° í™˜ê²½ ë³€ìˆ˜ ë¶„ë¦¬\n\n### Project Delivery Risks\n- Timeline Risks: ì˜ì¡´ì„± ì§€ì—° â†’ ìŠ¤ì½”í”„ ì¡°ì • ë° ë°ì¼ë¦¬ ìŠ¤íƒ ë“œì—…  \n- Resource Risks: ì¸ë ¥ ë¶€ì¡± â†’ í¬ë¡œìŠ¤ íŠ¸ë ˆì´ë‹, ì™¸ë¶€ ì»¨ì„¤íŒ… í™œìš©  \n- Quality Risks: í…ŒìŠ¤íŠ¸ ë¶€ì¡± â†’ ìœ ë‹›Â·í†µí•© í…ŒìŠ¤íŠ¸ ìš°ì„  ë„ì…  \n- Deployment Risks: ì„¤ì • ì˜¤ë¥˜ â†’ IaC(GitOps), ìŠ¤í…Œì´ì§• ê²€ì¦  \n\n**Contingency Plans**  \n- MVP ë²”ìœ„ ìœ ì§€, í˜ì´ì¦ˆë³„ ìš°ì„ ìˆœìœ„ ì¬ì¡°ì •  \n- ë¡¤ë°± ê°€ëŠ¥í•œ ë°°í¬ íŒŒì´í”„ë¼ì¸ ì„¤ê³„  \n- ì™¸ë¶€ ì„œë¹„ìŠ¤ ì¥ì•  ì‹œ ëŒ€ì²´ ì›Œí¬í”Œë¡œìš° ë¬¸ì„œí™”",
      "writedAt": "2025-07-20T07:19:19.083Z"
    },
    {
      "type": "guideline",
      "content": "# Code Guidelines for Next.js AI Coding Dashboard\n\n## 1. Project Overview  \nThis project delivers a modern AIâ€powered dashboard that:  \n- Uses Next.js 15 App Router and React 19 with TypeScript for a fileâ€based, serverâ€first architecture.  \n- Streams TRD generation via Vercel AI SDK and Brave Search.  \n- Renders realâ€time Markdown with syntax highlighting.  \n- Decomposes TRD into actionable tasks via Taskmaster MCP.  \n- Persists data in Supabase with RLS, React Hook Form/Zod for validation, and Tailwind CSS/shadcn/ui for styling.\n\n## 2. Core Principles  \n1. **Single Responsibility**: Each module or component MUST have one clear purpose.  \n2. **Strong Typing**: All public interfaces, props, API payloads, and DB models MUST use explicit TypeScript types or Zod schemas.  \n3. **Domain Organization**: Files and folders MUST follow domain/feature boundaries (`project-form/`, `trd-viewer/`, `task-cards/`).  \n4. **Streaming-First**: AI endpoints MUST support streaming `ReadableStream` and client hooks to display incremental updates.  \n5. **Secure by Default**: All database calls MUST use Supabase RLS policies; API routes MUST validate inputs with Zod.\n\n## 3. Languageâ€Specific Guidelines  \n\n### 3.1 TypeScript & Next.js  \n- **File Layout**:  \n  - `/src/app/...` for pages/routes (max lines per file as per TRD).  \n  - `/src/components/<feature>/` for UI.  \n  - `/src/lib/` for API clients and infrastructure.  \n  - `/src/hooks/` for custom hooks.  \n  - `/src/types/` for reusable type definitions.  \n- **Imports**:  \n  - Use absolute imports via `tsconfig.json` paths:  \n    ```ts\n    import { useAIStream } from '@/hooks/use-ai-stream'\n    ```  \n- **Error Handling**:  \n  - In API routes, wrap logic in `try/catch` and return `NextResponse.json({ error: message }, { status: code })`.  \n  - Use Next.js error boundaries (`error.tsx`) for route-level errors.\n\n### 3.2 React & Hooks  \n- **State**: Prefer local state for UI; use `use-project` for shared project context.  \n- **Effects**: Clean up subscriptions/streams in `useEffect` return to avoid memory leaks.  \n- **Forms**: Define Zod schema, then:  \n  ```ts\n  const schema = z.object({ idea: z.string().min(1) });\n  const { register, handleSubmit } = useForm({ resolver: zodResolver(schema) });\n  ```  \n\n### 3.3 Tailwind CSS & shadcn/ui  \n- Use `tailwind-merge` when conditionally combining classes:  \n  ```ts\n  cn('px-4', condition && 'bg-primary')\n  ```  \n- No inline styles or CSS modules. All design tokens via Tailwind or shadcn/ui props.\n\n### 3.4 Supabase & SQL  \n- Always use parameterized queries via Supabase client.  \n- Adhere to RLS policies; never bypass with `service_role` in client code.  \n- Keep schema migrations in a versioned SQL folder.\n\n## 4. Code Style Rules  \n\n### 4.1 MUST Follow  \n- **ESLint & Prettier**: Enforce lint rules and auto-format on save.  \n- **Explicit Returns**: Always type function return values.  \n- **Zod Validation**: Validate all external inputs.  \n- **Streaming API Pattern**:   \n  ```ts\n  // api/ai/route.ts\n  export async function POST(req: Request) {\n    const { prompt } = await req.json();\n    const stream = streamText({ model: ..., messages: [...] });\n    return stream.toDataStreamResponse();\n  }\n  ```  \n- **Component Length**: Keep JSX files under the max line counts specified in TRD.  \n\n### 4.2 MUST NOT Do  \n- **No `any`**: Avoid `any` or implicit `any`.  \n- **No Monoliths**: Do not create files >150 lines or mix UI/API in one module.  \n- **No Inline Fetch**: All external calls MUST go through `/src/lib/*`.  \n- **No CSS-in-JS**: Do not introduce styled-components or emotion.  \n- **No Mixed Concerns**: Do not handle business logic inside UI-only components.\n\n## 5. Architecture Patterns  \n\n### 5.1 Component/Module Structure  \n- **Presentation vs. Container**:  \n  - Presentation components in `components/ui` accept props only.  \n  - Container components in `components/<feature>` handle hooks and data.  \n- **Domain Modules**: Group by feature:  \n  ```\n  components/\n  â”œ project-form/\n  â”œ trd-viewer/\n  â”” task-cards/\n  ```\n\n### 5.2 Data Flow  \n- **Client â†’ API**: Fetch via Next.js `app/api/*` endpoints, returning JSON or streaming.  \n- **State Hooks**:  \n  - `use-project` for project metadata.  \n  - `use-ai-stream` for TRD streaming.  \n  - `use-mcp` for task breakdown.  \n- **Optimistic Updates**: Use callbacks in hooks to update Supabase immediately on success.\n\n### 5.3 API Design  \n- **Endpoints**:  \n  - POST `/api/ai` for TRD streaming.  \n  - POST `/api/search` for Brave Search.  \n- **Payloads**: Typed interfaces in `types/`:  \n  ```ts\n  export interface AIRequest { prompt: string; context: string; }\n  export interface Task { title: string; description: string; ... }\n  ```\n\n## 6. Example Code Snippets  \n\n```typescript\n// MUST: Absolute import and single responsibility\nimport { breakdownToTasks } from '@/lib/mcp/taskmaster';\n\nexport async function getTasks(trd: string) {\n  return breakdownToTasks(trd);  // clear delegate to lib\n}\n```\n\n```typescript\n// MUST NOT: Implicit any, mixed logic and UI\nexport function TRDPage(props) {\n  fetch('/api/ai', { method: 'POST', body: JSON.stringify({prompt: props.prompt}) })\n    .then(res => res.json())\n    .then(data => console.log(data))\n    .catch(err => console.error(err));\n  return <div>{/* UI + fetch in same file */}</div>;\n}\n```\n\n```jsx\n// MUST: Zod + React Hook Form\nimport { z } from 'zod';\nimport { useForm } from 'react-hook-form';\nconst schema = z.object({ idea: z.string().min(1) });\nfunction IdeaStep() {\n  const { register, handleSubmit } = useForm({ resolver: zodResolver(schema) });\n  return <form onSubmit={handleSubmit(onSubmit)}><textarea {...register('idea')} /></form>;\n}\n```\n\n```jsx\n// MUST NOT: Large component, no schema\nfunction BigForm() {\n  // 300 lines mixing UI, fetch, validation, state\n}\n```\n\n```ts\n// MUST: Next.js error handler in route\nexport async function POST(req: Request) {\n  try {\n    const { prompt } = await req.json();\n    // ...\n  } catch (e) {\n    return NextResponse.json({ error: (e as Error).message }, { status: 500 });\n  }\n}\n```\n\n```ts\n// MUST NOT: Swallow errors\nexport async function POST(req: Request) {\n  const { prompt } = await req.json();\n  streamText({ /* missing try/catch */ });\n}\n```\n\n---\n\n_End of Guidelines_",
      "writedAt": "2025-07-20T07:19:19.083Z"
    }
  ]
}